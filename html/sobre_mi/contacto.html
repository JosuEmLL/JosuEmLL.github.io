<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>html,body{height:100%;margin:0}body{display:flex;align-items:center;justify-content:center}</style>
    <title>Contacto</title>
    <style>
        :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0}
        body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f5f7fa;padding:20px}
        .card{background:#fff;padding:24px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.08);width:100%;max-width:520px}
        h1{margin:0 0 16px;font-size:1.25rem}
        .field{display:flex;flex-direction:column;margin-bottom:12px}
        label{font-size:.9rem;margin-bottom:6px;color:#333}
        input[type="text"], input[type="email"], textarea{
            padding:10px;border:1px solid #d1d7df;border-radius:6px;font-size:1rem;outline:none;
        }
        input:focus, textarea:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.12)}
        textarea{min-height:120px;resize:vertical}
        .actions{display:flex;justify-content:flex-end;margin-top:8px}
        button{background:#2563eb;color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-size:1rem}
        button:active{transform:translateY(1px)}
        .note{font-size:.85rem;color:#6b7280;margin-top:8px}
        .error{color:#dc2626;font-size:.88rem;margin-top:6px}
    </style>
</head>
<body>
    <main class="card" aria-labelledby="titulo">
        <h1 id="titulo">Contáctame</h1>

        <form id="contactForm" novalidate>
            <div class="field">
                <label for="nombre">Nombre</label>
                <input id="correo" name="correo" type="email" required autocomplete="email" />
                <label for="correo">Correo electrónico</label>
                <input id="nombre" name="nombre" type="text" required autocomplete="name" />
            </div>
            <input type="hidden" id="asunto_hidden" name="asunto" value="Contacto desde la web" />
            <script src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script>
            <script>
            (function(){
                // Inicializa EmailJS: reemplaza por tu clave pública
                emailjs.init('oUJgHtIlhtWkjOTOG');

                const form = document.getElementById('contactForm');
                const errorEl = document.getElementById('error');
                const ownerEmail = '182078@upslp.edu.mx';
                // Mostrar campo "asunto" en la interfaz y eliminar el input oculto (si existe)
                document.addEventListener('DOMContentLoaded', function(){
                    // eliminar estilos que ocultaban el asunto
                    document.querySelectorAll('style').forEach(s=>{
                        if(/label\[for="asunto"\],\s*input#asunto/.test(s.textContent)){
                            s.remove();
                        }
                    });
                    // eliminar input hidden
                    const h = document.getElementById('asunto_hidden');
                    if(h) h.remove();
                    // Asegurar que el campo asunto sea requerido y visible
                    const asunto = document.getElementById('asunto');
                    if(asunto){
                        asunto.required = true;
                        asunto.removeAttribute('hidden');
                        asunto.style.display = '';
                    }
                });
                // Capturing listener para interceptar el envío antes del listener existente
                form.addEventListener('submit', function(e){
                    e.preventDefault();
                    e.stopImmediatePropagation(); // evita que el listener anterior abra mailto
                    errorEl.hidden = true;

                    const nombre = (form.nombre && form.nombre.value || '').trim();
                    const correo = (form.correo && form.correo.value || '').trim();
                    const asunto = (form.asunto && form.asunto.value || '').trim();
                    const mensaje = (form.mensaje && form.mensaje.value || '').trim();

                    if(!nombre || !correo || !asunto || !mensaje){
                        errorEl.textContent = 'Por favor completa todos los campos.';
                        errorEl.hidden = false;
                        return;
                    }

                    // Parámetros para la plantilla que recibirá el propietario
                    const ownerParams = {
                        from_name: nombre,
                        from_email: correo,
                        to_email: ownerEmail,
                        subject: asunto,
                        message: mensaje
                    };

                    // Parámetros para la plantilla de autoreply (envío al remitente)
                    const autoreplyParams = {
                        to_name: nombre,
                        to_email: correo,
                        reply_subject: 'Re: ' + asunto,
                        reply_message: 'Gracias por contactarme. He recibido tu mensaje y te responderé pronto.\n\nTu mensaje:\n' + mensaje
                    };

                    // Reemplaza SERVICE_ID y TEMPLATE_ID_* por tus valores de EmailJS
                    const SERVICE_ID = 'service_4yx4mh9';
                    const TEMPLATE_OWNER = 'template_jb4bqzz';
                    const TEMPLATE_AUTOREPLY = 'template_ejzj59i';

                    // Envía al propietario, luego envía el autoreply al remitente
                    emailjs.send(SERVICE_ID, TEMPLATE_OWNER, ownerParams)
                        .then(function(){
                            return emailjs.send(SERVICE_ID, TEMPLATE_AUTOREPLY, autoreplyParams);
                        })
                        .then(function(){
                            errorEl.style.color = '#16a34a';
                            errorEl.textContent = 'Mensaje enviado. Se ha enviado una copia a tu correo.';
                            errorEl.hidden = false;
                            form.reset();
                        })
                        .catch(function(err){
                            console.error('EmailJS error:', err);
                            errorEl.style.color = '';
                            errorEl.textContent = 'Error al enviar el mensaje. Intenta más tarde.';
                            errorEl.hidden = false;
                        });

                }, true);
            })();
            </script>
            <div class="field">
                <label for="asunto">Asunto</label>
                <input id="asunto" name="asunto" type="text" required autocomplete="off" />
            </div>

            <div class="field">
                <label for="mensaje">Mensaje</label>
                <textarea id="mensaje" name="mensaje" required></textarea>
            </div>

            <div class="actions">
                <button type="submit">Enviar mensaje</button>
            </div>

            <p class="note">Al enviar, se recibira un correo de autorespuesta de la dirección 182078@upslp.edu.mx. Hasta que se pueda poner en contacto con usted.</p>
            <p id="error" class="error" hidden></p>
        </form>
    </main>

    <script>
        (function(){
            const form = document.getElementById('contactForm');
            const errorEl = document.getElementById('error');
            const destination = '182078@upslp.edu.mx';

            form.addEventListener('submit', function(e){
                e.preventDefault();
                errorEl.hidden = true;
                const nombre = form.nombre.value.trim();
                const asunto = form.asunto.value.trim();
                const mensaje = form.mensaje.value.trim();

                if(!nombre || !asunto || !mensaje){
                    errorEl.textContent = 'Por favor completa todos los campos.';
                    errorEl.hidden = false;
                    return;
                }

                const subject = encodeURIComponent(asunto);
                const bodyLines = [
                    'Nombre: ' + nombre,
                    '',
                    'Mensaje:',
                    mensaje
                ];
                const body = encodeURIComponent(bodyLines.join('\n'));
                const mailto = 'mailto:' + destination + '?subject=' + subject + '&body=' + body;
                window.location.href = mailto;
            });
        })();
    </script>
</body>
</html>